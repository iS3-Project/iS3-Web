<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>A WebGIS Application</title>
    <meta name="author" content="Xiaodong Lin">
    <link href="external/ol3-3.19.1/ol.min.css" rel="stylesheet">
    <link href="css/webgis-debug.css" rel="stylesheet">
    <script type="text/javascript" src="external/ol3-3.19.1/ol-debug.js"></script>
    <script type="text/javascript" src="external/jquery-3.1.1/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="js/webgis-debug.js"></script>
</head>
<body>
<div id="map-container">
    <div id="topContainer"></div>
    <div id="centerContainer"></div>
    <div id="bottomContainer"></div>
</div>
<script>

    /* globals iS3 */
    /* globals ol */
    /* globals GoldenLayout */

    document.addEventListener('DOMContentLoaded', init);
    function init() {

        // Top layout
        var configTop = {
            settings: {hasHeaders: false},
            dimensions: {
                borderWidth: 4
            },
            content: [{
                type: 'row',
                content: [{
                    type: 'component',
                    componentName: 'topComponent'
                }]
            }]
        };
        var myLayoutTop = new GoldenLayout(configTop, $('#topContainer'));
        myLayoutTop.registerComponent('topComponent', function (container, componentState) {
            container.getElement().html('<div id="toolbar" class="toolbar"></div>');
        });
        myLayoutTop.init();

        // Center layout
        var configCenter = {
            settings: {
                showPopoutIcon: false,
                showMaximiseIcon: true,
                showCloseIcon: false
            },
            dimensions: {
                borderWidth: 4
            },
            content: [{
                type: 'row',
                content: [{
                    type: 'column',
                    width: 20,
                    content: [{
                        type: 'component',
                        componentName: 'layertree'
                    }, {
                        type: 'stack',
                        content: [{
                            type: 'component',
                            componentName: 'data'
                        }, {
                            type: 'component',
                            componentName: 'datatree'
                        }]
                    }]
                }, {
                    type: 'stack',
                    content: [{
                        type: 'component',
                        componentName: 'map'
                    }, {
                        type: 'component',
                        componentName: '3D'
                    }]
                }]
            }]
        };
        var myLayoutCenter = new GoldenLayout(configCenter, $('#centerContainer'));
        myLayoutCenter.registerComponent('layertree', function (container, componentState) {
            container.getElement().html('<div id="layertree" class="layertree"></div>');
        });
        myLayoutCenter.registerComponent('map', function (container, componentState) {
            container.getElement().html('<div id="map" class="map"></div>');
        });
        myLayoutCenter.registerComponent('data', function (container, componentState) {
            container.getElement().html('<div id="data" class="data"></div>');
        });
        myLayoutCenter.registerComponent('datatree', function (container, componentState) {
            container.getElement().html('<div id="datatree" class="datatree"></div>');
        });
        myLayoutCenter.registerComponent('3D', function (container, componentState) {
            container.getElement().html('<div id="3D" class="3D"></div>');
        });
        myLayoutCenter.init();

        iS3.domTool.activeTabByComponentName(myLayoutCenter, 'datatree');

        // Bottom layout
        var configBottom = {
            settings: {hasHeaders: false},
            dimensions: {
                borderWidth: 4
            },
            content: [{
                type: 'row',
                content: [{
                    type: 'component',
                    componentName: 'bottomComponent'
                }]
            }]
        };
        var myLayoutBottom = new GoldenLayout(configBottom, $('#bottomContainer'));
        myLayoutBottom.registerComponent('bottomComponent', function (container, componentState) {
            container.getElement().html('<div class="notification-bar">'
                + '<div id="messageBar" class="message-bar"></div>'
                + '<div id="projection"></div>'
                + '<div id="coordinates"></div>'
                + '</div>');
        });
        myLayoutBottom.init();

        document.removeEventListener('DOMContentLoaded', init);

        $.getJSON('./config.json', function (json) {
            var main = new iS3.Main({
                config: json
            });

            // resize events
            $(window).resize(function () {
                setTimeout(function () {
                    myLayoutTop.updateSize();
                    myLayoutCenter.updateSize();
                    myLayoutBottom.updateSize();
                    iS3Project.getMap().updateSize();
                }, 200);
            });

            var resizeMap = document.getElementById('map');
            var resizecallback = function () {
                $(window).trigger('resize');
            };
            window.addResizeListener(resizeMap, resizecallback);
        });
    }
</script>
</body>
</html>